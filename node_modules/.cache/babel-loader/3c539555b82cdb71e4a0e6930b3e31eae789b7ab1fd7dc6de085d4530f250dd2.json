{"ast":null,"code":"// Simple WebSocket client with reconnect and event callbacks\nconst DEFAULT_PATH = '/ws/updates';\nclass WSClient {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Set();\n    this.backoff = 1000;\n    this.maxBackoff = 30000;\n    this.connected = false;\n    this._init();\n  }\n  _getUrl() {\n    const base = process.env.REACT_APP_API_URL || window.location.origin;\n    try {\n      const u = new URL(base);\n      const proto = u.protocol === 'https:' ? 'wss:' : 'ws:';\n      return proto + '//' + u.host + DEFAULT_PATH;\n    } catch (e) {\n      // fallback\n      const proto = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      return proto + '//' + window.location.host + DEFAULT_PATH;\n    }\n  }\n  _init() {\n    const url = this._getUrl();\n    try {\n      this.socket = new WebSocket(url);\n    } catch (e) {\n      this._scheduleReconnect();\n      return;\n    }\n    this.socket.onopen = () => {\n      this.connected = true;\n      this.backoff = 1000;\n    };\n    this.socket.onmessage = ev => {\n      let payload = null;\n      try {\n        payload = JSON.parse(ev.data);\n      } catch (e) {\n        return;\n      }\n      for (const fn of this.listeners) fn(payload);\n    };\n    this.socket.onclose = () => {\n      this.connected = false;\n      this._scheduleReconnect();\n    };\n    this.socket.onerror = () => {\n      this.socket.close();\n    };\n  }\n  _scheduleReconnect() {\n    setTimeout(() => this._init(), this.backoff);\n    this.backoff = Math.min(this.backoff * 1.5, this.maxBackoff);\n  }\n  subscribe(fn) {\n    this.listeners.add(fn);\n    return () => this.listeners.delete(fn);\n  }\n}\nconst wsClient = new WSClient();\nexport default wsClient;","map":{"version":3,"names":["DEFAULT_PATH","WSClient","constructor","socket","listeners","Set","backoff","maxBackoff","connected","_init","_getUrl","base","process","env","REACT_APP_API_URL","window","location","origin","u","URL","proto","protocol","host","e","url","WebSocket","_scheduleReconnect","onopen","onmessage","ev","payload","JSON","parse","data","fn","onclose","onerror","close","setTimeout","Math","min","subscribe","add","delete","wsClient"],"sources":["/home/aliullah/final_project_34/frontend/src/services/ws.js"],"sourcesContent":["// Simple WebSocket client with reconnect and event callbacks\nconst DEFAULT_PATH = '/ws/updates';\n\nclass WSClient {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Set();\n    this.backoff = 1000;\n    this.maxBackoff = 30000;\n    this.connected = false;\n    this._init();\n  }\n\n  _getUrl() {\n    const base = process.env.REACT_APP_API_URL || window.location.origin;\n    try {\n      const u = new URL(base);\n      const proto = u.protocol === 'https:' ? 'wss:' : 'ws:';\n      return proto + '//' + u.host + DEFAULT_PATH;\n    } catch (e) {\n      // fallback\n      const proto = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      return proto + '//' + window.location.host + DEFAULT_PATH;\n    }\n  }\n\n  _init() {\n    const url = this._getUrl();\n    try {\n      this.socket = new WebSocket(url);\n    } catch (e) {\n      this._scheduleReconnect();\n      return;\n    }\n    this.socket.onopen = () => {\n      this.connected = true;\n      this.backoff = 1000;\n    };\n    this.socket.onmessage = (ev) => {\n      let payload = null;\n      try { payload = JSON.parse(ev.data); } catch (e) { return; }\n      for (const fn of this.listeners) fn(payload);\n    };\n    this.socket.onclose = () => {\n      this.connected = false;\n      this._scheduleReconnect();\n    };\n    this.socket.onerror = () => {\n      this.socket.close();\n    };\n  }\n\n  _scheduleReconnect() {\n    setTimeout(() => this._init(), this.backoff);\n    this.backoff = Math.min(this.backoff * 1.5, this.maxBackoff);\n  }\n\n  subscribe(fn) { this.listeners.add(fn); return () => this.listeners.delete(fn); }\n}\n\nconst wsClient = new WSClient();\nexport default wsClient;\n"],"mappings":"AAAA;AACA,MAAMA,YAAY,GAAG,aAAa;AAElC,MAAMC,QAAQ,CAAC;EACbC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,MAAM,GAAG,IAAI;IAClB,IAAI,CAACC,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC1B,IAAI,CAACC,OAAO,GAAG,IAAI;IACnB,IAAI,CAACC,UAAU,GAAG,KAAK;IACvB,IAAI,CAACC,SAAS,GAAG,KAAK;IACtB,IAAI,CAACC,KAAK,CAAC,CAAC;EACd;EAEAC,OAAOA,CAAA,EAAG;IACR,MAAMC,IAAI,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAIC,MAAM,CAACC,QAAQ,CAACC,MAAM;IACpE,IAAI;MACF,MAAMC,CAAC,GAAG,IAAIC,GAAG,CAACR,IAAI,CAAC;MACvB,MAAMS,KAAK,GAAGF,CAAC,CAACG,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,KAAK;MACtD,OAAOD,KAAK,GAAG,IAAI,GAAGF,CAAC,CAACI,IAAI,GAAGtB,YAAY;IAC7C,CAAC,CAAC,OAAOuB,CAAC,EAAE;MACV;MACA,MAAMH,KAAK,GAAGL,MAAM,CAACC,QAAQ,CAACK,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,KAAK;MACpE,OAAOD,KAAK,GAAG,IAAI,GAAGL,MAAM,CAACC,QAAQ,CAACM,IAAI,GAAGtB,YAAY;IAC3D;EACF;EAEAS,KAAKA,CAAA,EAAG;IACN,MAAMe,GAAG,GAAG,IAAI,CAACd,OAAO,CAAC,CAAC;IAC1B,IAAI;MACF,IAAI,CAACP,MAAM,GAAG,IAAIsB,SAAS,CAACD,GAAG,CAAC;IAClC,CAAC,CAAC,OAAOD,CAAC,EAAE;MACV,IAAI,CAACG,kBAAkB,CAAC,CAAC;MACzB;IACF;IACA,IAAI,CAACvB,MAAM,CAACwB,MAAM,GAAG,MAAM;MACzB,IAAI,CAACnB,SAAS,GAAG,IAAI;MACrB,IAAI,CAACF,OAAO,GAAG,IAAI;IACrB,CAAC;IACD,IAAI,CAACH,MAAM,CAACyB,SAAS,GAAIC,EAAE,IAAK;MAC9B,IAAIC,OAAO,GAAG,IAAI;MAClB,IAAI;QAAEA,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,EAAE,CAACI,IAAI,CAAC;MAAE,CAAC,CAAC,OAAOV,CAAC,EAAE;QAAE;MAAQ;MAC3D,KAAK,MAAMW,EAAE,IAAI,IAAI,CAAC9B,SAAS,EAAE8B,EAAE,CAACJ,OAAO,CAAC;IAC9C,CAAC;IACD,IAAI,CAAC3B,MAAM,CAACgC,OAAO,GAAG,MAAM;MAC1B,IAAI,CAAC3B,SAAS,GAAG,KAAK;MACtB,IAAI,CAACkB,kBAAkB,CAAC,CAAC;IAC3B,CAAC;IACD,IAAI,CAACvB,MAAM,CAACiC,OAAO,GAAG,MAAM;MAC1B,IAAI,CAACjC,MAAM,CAACkC,KAAK,CAAC,CAAC;IACrB,CAAC;EACH;EAEAX,kBAAkBA,CAAA,EAAG;IACnBY,UAAU,CAAC,MAAM,IAAI,CAAC7B,KAAK,CAAC,CAAC,EAAE,IAAI,CAACH,OAAO,CAAC;IAC5C,IAAI,CAACA,OAAO,GAAGiC,IAAI,CAACC,GAAG,CAAC,IAAI,CAAClC,OAAO,GAAG,GAAG,EAAE,IAAI,CAACC,UAAU,CAAC;EAC9D;EAEAkC,SAASA,CAACP,EAAE,EAAE;IAAE,IAAI,CAAC9B,SAAS,CAACsC,GAAG,CAACR,EAAE,CAAC;IAAE,OAAO,MAAM,IAAI,CAAC9B,SAAS,CAACuC,MAAM,CAACT,EAAE,CAAC;EAAE;AAClF;AAEA,MAAMU,QAAQ,GAAG,IAAI3C,QAAQ,CAAC,CAAC;AAC/B,eAAe2C,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}